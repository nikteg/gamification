<!DOCTYPE html>
<html>
<head>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" charset="utf-8"></script>
	<script src="../gaussian/lib/gaussian.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>


	<style>
		body{
		background-color: #fff;
		}
		.structure{
		position: absolute;
		top:0px;
		left: 0px;
		padding: 0;
		margin: 0;
		}
		
		.partContainer{
		display: flex;
		background: #eee;
		}
		
		
		.right{
		position:fixed;
		height: 1000px;
		width: 50%;
		padding-left: 10px;
		padding-top: 10px;
		background: #eee;
		}
		
		.left{
		padding-left: 7%;
		height: ;
		width:47%;
		border-right: 1px solid gray;
		//padding-left: 10px;
		padding-top: 10px;
		background:white;
		}
		
		.fixed{
			position:fixed;
			border-bottom: 1px solid #ccc;
		}
		
		.title{
			font-family: "Palatino Linotype","Book Antiqua", Palatino serif;
			padding:0;
			margin:0;
			font-weight: normal;
			padding-bottom: 10px;
		}
		.text{
		
		}
		
		.part{
			width: 90%;
			margin-left: 0;
			border-bottom: 1px solid #ccc;
			margin-top: 15px;
			padding-bottom: 30px;
		}
		
	.breadCrumbsBar {
		display: flex;
		padding: 0;
		margin: 0;
		background: #eee;
		font-size: 15px;
		box-shadow: 0px 0px 100px #ddd;
		font-family: "Palatino Linotype","Book Antiqua", Palatino serif;
		border-bottom: 1px solid #ccc;
	}
	
	.breadCrumbs li{
		list-style: none;
		display:inline;
	}
	
	.breadCrumbsDiv{
		width: 100%;
		height: 50px;
	}
	
	.progress{
		background: #eee;
		height: 0px;
		width: 100%;
		border-bottom: 1px solid #ccc;
	}
		
	.listMargin li{
		margin-top: 10px;
	}	
	
	.answer{
		width: 90%;
		margin-left: 0;
		border-bottom: 1px solid #ccc;
		margin-top: 15px;
		padding-bottom: 30px;
		color:#844B46;
	}
	
	#right{
	}
	
	</style>
</head>
<body>
	<div class="structure">
		<div class="partContainer">
			<img class="fixed" src="Header.png" style="width: 100%; height: 100px">
		</div>	
				
		<div class="partContainer">
			<img src="Header.png" style="width: 100%; height: 100px">
		</div>
			
		<div class="breadCrumbsBar">
			<div class="breadCrumbsDiv">
				<ul class="breadCrumbs">
					<li>Home |</li>
					<li>Statistics and probability |</li>
					<li><a href="./SketchHtml.html">Normal distribution</a>  |</li>
					<li><a href="./ExperimentHtml.html">Experiment 1</a>  |</li>
					<li><b>Experiment 2</b></li>
					<li><span style="padding-left:42%">Step 2 of 4</span></li>
				</ul>
			</div>

			
		</div>
		
		<div class="progress">
			<svg width="100%" height="40">

			</svg>
		</div>

		<div class="partContainer">
			<div class="left">
				<div class="part">
						<h2 class="title">Step 2 - Conduct the experiment</h2>
						<h3 class="title">General information</h3>
						Now it is time to perform the statistical experiment from the previous step iteratively until enough data has been gathered. The more samples gathered, the more accurate the information will be. When measuring attributes of the subject of the experiment one should be mindful of the fact that certain interval of errors of measurement will occur.
						<br><br>
						Graphing can be done once enough data has been gathered. Let X be a random variable containing the distribution of the subject and x be one of the values of X. The sample distribution can then be graphed by: 
						<br><br>
						Y axis: frequency of X = x
						<br>
						X axis: x
						<br><br>
						Whether X is discrete or continuous, it is often necessary to group the data in intervals to make sure the data isnâ€™t too spread out, especially if the sample size is small in comparison to its variance. The most common groups are 10 integer intervals (e.g the group 1 contains all values from -5 to 5) and 1 integer intervals (e.g the group 1 contains -0.5 to 0.5).  

				</div>
				<div class="part">
					<h3 class="title">This experiment</h3>
					In this experiment, we would begin with measuring the height of different people. Luckily, we already have a dataset of measured heights available to us. 
					<br><br>
					<a href="http://socr.ucla.edu/docs/resources/SOCR_Data/SOCR_Data_Dinov_020108_HeightsWeights.html">Link to dataset</a>
					<br><br>
					If you take a look at the data-set, you can see that the dataset has a size of about 20 000 measures. With some educated guesses, we conclude that the height would probably range from about 140 to 240 cm. This means the variance is rather small in contrast to the sample size. Thus, we decide to group the values to 1 integer. 
					<br><br>
					Let us graph it by frequency on the y axis and by height on the x axis:

				</div>
				<div class="answer">
					Experiments and observations
					<ol class="listMargin">
						
				
						<li>How does the distribution look when we use a smaller sample size?</li>
						<li>What would happen if we had an even bigger sample size?</li>
						<li>What happens if we do not round the data(Imagine we have infinite decimals)? Why does this happen?</li>
						<li>What happens if we round the data too much?</li>
						<li>How is the data distributed? What kind of distribution does it resemble?</li>
						<li>Is the distribution continuous or discrete? How do we know?</li>
						<li>What is the probability that a person is less than 180 cm tall (according to our samples)?</li>
						<li>What is the probability that a person is more than 200 cm tall (according to our samples)?</li>
						<li>What is the probability that a person is between 140-160 cm tall (according to our samples)? </li>
						<li>Is it possible to find out the probability to be less than 180.001 cm tall? </li>

						
					</ol>
				</div>
				
			</div>
			
			<div class="right" id="right">
			
			
		<script>
			
			
			//____________________________________________________________________________
			//Initialization and variables
			var exp = 180;
			variance = 50;
			var distribution = gaussian(exp,variance);
			
			//Visuals data Svg
			var dataHeight = 70;
			
			//Visuals graph
			
			var height = 340,
				heightOffsetTop = 10,
				heightOffsetBottom = 20,
				width = 520,
				widthOffsetLeft = 35,
				widthOffsetRight = 20,
				maxY = 15;
			
			//limitations
			var maxN= 2000;
				maxDec= 2;
			
			//Data values	
			var	n = 200000,
				decimals = 0,
				leastValueX = exp-variance/2,
				maxValueX= exp+variance/2;
				
			var	realxrange = exp*2;
			
			//Colors, graph specific elements
			var	graphBGColor = "#eee",
				graphLineColor = "#ff7f0e",
				axisColor = "steelblue",
				markerColor = "steelblue";
				
			//Colors, other elements
			var circleColor = "crimson",
				coordinateTextColor = "crimson",
				cumulativeTextColor = "steelblue",
				cursorColor = "white";
				stapleAreaColor = "#ABC497";
			
			//Svg graph element to body
			var graphSvg = d3.select(".right").append("svg:svg")
				.style("background", graphBGColor)
				.attr("height", height+heightOffsetBottom)
				.attr("width", width+widthOffsetLeft+widthOffsetRight)	
			
			//Svg raw data element to body
			var dataSvg = d3.select(".right").append("svg:svg")
				.style("background", graphBGColor)
				.attr("height", dataHeight)
				.attr("width", width+widthOffsetLeft+widthOffsetRight)	
			
			//DOM elements
			
			var divContainer = document.createElement("div");
			divContainer.style.height = "50px";
			divContainer.style.width = width+widthOffsetRight+widthOffsetRight+"px";
			divContainer.style.background ="#eee";
			document.getElementById("right").appendChild(divContainer);
			
			
			var input = document.createElement("input");
			input.id = "range";
			input.type = "range";
			input.className = "input";
			input.min = "1";
			input.max = "2000";
			input.value = "1";
			input.style.margin = "10px";
			divContainer.appendChild(input);
			
			var inputText = document.createElement("input");
			inputText.id = "text";
			inputText.type ="text";
			inputText.size ="3";
			inputText.style.marginLeft = "10px";
			inputText.defaultValue = input.value;
			divContainer.appendChild(inputText);
			
			
			
			var sampleButton = document.createElement("button");
			sampleButton.innerHTML = "Add samples";
			sampleButton.id = "hej";
			sampleButton.style.marginLeft = "10px";
			divContainer.appendChild(sampleButton);
			
			var resetButton = document.createElement("button");
			resetButton.innerHTML = "Reset graph";
			divContainer.appendChild(resetButton);
			resetButton.style.marginLeft = "10px";
			
			var deselectStaplesButton = document.createElement("button");
			deselectStaplesButton.innerHTML = "Deselect all staples";
			divContainer.appendChild(deselectStaplesButton);
			deselectStaplesButton.style.marginLeft = "10px";
			

			
			
			
			
			//______________________________________________________________________________________________
			//Functions
			
			//Initialize dataset function
			function initData(data, decimals){
				for(i = 0; i < (maxValueX-leastValueX)*Math.pow(10,decimals); i++){
					data[i] = [i/Math.pow(10,decimals)+leastValueX, 0];
				}
				return data;
			}
			
			//GenerateData function
			function generateNewData(dataMatrix, dist, iterations, dec){
				for(i = 0; i < iterations; i++){
					var key = +(dist.ppf(Math.random())).toFixed(dec);
					var keyFound = false;
					
					dataMatrix.forEach(function(entry){
						if(entry[0] == key){
							entry[1] += 1;
							keyFound = true;
						}
					});
				//Didn't find key, create new key
					if(keyFound === false){
						dataMatrix[dataMatrix.length] = [key, 1];
					}
				}
				return dataMatrix;
			}
			
			//function actual expectancy
			function sampleMean(data, xindex, yindex){
				var totalValue = 0;
				var n = 0;
				data.forEach(function(entry){
						totalValue += entry[xindex] * entry[yindex];
						n += entry[yindex];
				})
				return totalValue/n;
			}
			
			//function actual variance
			function sampleVariance(data, xindex, yindex){
				var mean = sampleMean(data, xindex, yindex);
				var totalVariance = 0;
				var n = 0;
				data.forEach(function(entry){
					totalVariance += Math.pow(entry[xindex]-mean, 2) * entry[yindex];
					n += entry[yindex];
				});
				return totalVariance/n;
			}
			//function actual cumulative distribution
			function sampleCumulDist(data, x, xindex, yindex){
				var totalValue = 0;
				var lessThanX = 0;
				var maxvalue = 0;
				var xval = 0;
				
				data.forEach(function(entry){
					totalValue += entry[yindex];
					var test = entry[xindex];
					if(x >= entry[xindex]){
						lessThanX += entry[yindex];
						maxvalue = test;
						xval = x;
					}
				})
				return lessThanX/totalValue;
			}
			
			
			
			

			//Initialize data variable
			//__________________________________________________________________________
			var data = [];
			data = initData(data, decimals);
			//__________________________________________________________________________
			
			
			
			
			//Calculate max y value
			function getMaxY(dataMatrix){
				currentMaxY = 0;
				dataMatrix.forEach(function(entry){
					if(entry[1]>currentMaxY){
						currentMaxY = entry[1];
					}
				})
				return currentMaxY;
			}
			
			//Deselect all rects
			function deselectAllRects(){
				rects
					.attr("id", "deselected")
					.attr("fill", "transparent");
			}
			
			
		//Scale functions 
			scalex = d3.scale.linear().domain([leastValueX,maxValueX]).range([widthOffsetLeft,width+widthOffsetLeft]);
			scaley = d3.scale.linear().domain([maxY, 0]).range([heightOffsetTop,height]);
			
			//Scale from data to item size
			xRange = d3.scale.linear().domain([leastValueX,realxrange]).range([widthOffsetLeft,width+widthOffsetLeft]);
			yRange = d3.scale.linear().domain([maxY,0]).range([heightOffsetTop,height]);
			
			//Scale from item size to data
			scaleAxisX = d3.scale.linear().domain([0,width]).range([leastValueX,maxValueX]);
			scaleAxisY = d3.scale.linear().domain([heightOffsetTop,height]).range([0,maxY]);
			
			
			//Update functions
			function updateYAxis(data, axis){
				var newMaxY = getMaxY(data)+10;
				scaley = d3.scale.linear().domain([newMaxY, 0]).range([heightOffsetTop,height]);
				axis = d3.svg.axis().scale(scaley).orient("left").ticks(10);
				yax.call(axis);
				
				yax
				.selectAll("text")
				.attr("fill",axisColor)
				.attr("font-size", "10px");	
				return newMaxY;
			}
			
			function updateRects(allRects, updatedData, decimals){
				
				if(getMaxY(updatedData) > maxY){
					maxY = updateYAxis(updatedData, yAxis);
					
				}
				
				allRects.data(updatedData)
					.transition()
					.duration(200)
					.attr("y", function(d){return scaley(d[1])})
					.attr("height", function(d){ return height-scaley(d[1])});
				
				updateExpText(expValueText, updatedData);
				updateSDText(sdText, updatedData);
				updateCumulText(cumulText, cumulX,updatedData);
				updateTotalX(totalX, updatedData);
				
			}
			
			//Helper function
			function getTotalData(mydata){
				var sum = 0;
				mydata.forEach(function(entry){
					sum += entry[1];
				})
				return sum;
			}
			
			
			//Staple text value
			var rectText = graphSvg.append("text")
				.attr("font-size", "12px")
				.attr("fill", "#4E633E")
				.attr("y", 15)
				
				
				
			
			//Create staples
			function createRects(smallData, decimals){
			var stapleWidth = (width-24)/((maxValueX-leastValueX)*Math.pow(10,decimals));
			var newRects = graphSvg.selectAll("rect.staple").data(smallData).enter().append("rect")
				.attr("class", "staple")
				.attr("x", function(d){return scalex(d[0])+stapleWidth/2})
				.attr("y", function(d){return scaley(d[1])})
				.attr("height", function(d){ return height-scaley(d[1])})
				.attr("width", stapleWidth)
				.attr("fill", "transparent")
				.attr("stroke-width", "1px")
				.attr("stroke", "gray")
				
				.on("mouseover", function(d){
					var selection = d3.select(this)
					.attr("id");
					
					if(selection === "selected"){
						d3.select(this)
						.attr("fill", "#DEF0D1")
					}else{
						d3.select(this)
						.attr("fill","#DEF0D1")
						.attr("stroke", "#4E633E")
					}
					
					rectText
					.attr("x", scalex(d[0])+(width-24)/(maxValueX-leastValueX)-30)
					.text("x:"+d[0]+", y:"+d[1])
					.attr("opacity", 1)
					
				})
				.on("mouseleave", function(){
					var selection = d3.select(this).attr("id");
					if(selection === "selected"){
						d3.select(this)
						.attr("fill", stapleAreaColor)
						.attr("stroke", "gray")
					}else{
						d3.select(this)
						.attr("fill", "transparent")
						.attr("stroke", "gray")
					}
					rectText
					.attr("opacity", 0)
				})
				
				.on("click", function(d,i){
					deselectAllRects();
					var allrects= d3.selectAll(".staple")[0];
					for(j = 0; j <= i; j++){
						d3.select(allrects[j])
						.attr("id", "selected")
						.attr("fill", "white")
						.transition()
						.attr("fill", stapleAreaColor);
					}

					cumulX = d[0];
					updateCumulText(cumulText, cumulX, d3.selectAll(".staple").data());
					
				})
				return newRects;
			}
			
			
			//__________________________________________________________________________
			//SVG Data functions
			
			function updateExpText(text,data){
				text
				.text("Sample mean: "+sampleMean(data,0,1).toFixed(2));
			}
			
			function updateSDText(text, data){
				text
				.text("Sample standard deviation: "+ Math.sqrt(sampleVariance(data,0,1)).toFixed(2));
			}
			
			function updateCumulText(text, x, data){
				text
				.text("Sample cumulative distribution: "+ sampleCumulDist(data,x,0,1).toFixed(3));
			}
			
			function updateTotalX(text, data){
				text
				.text("Total samples: "+ getTotalData(data));
			}
			
			//______________________________________________________________________________________
			//SVG Data element variables
			
			var expValueText = dataSvg.append("text")
				.text("Sample mean: ")
				.attr("fill","black")
				.attr("x", 20)
				.attr("class", "dataText")
				.attr("y", 20);
				
			var sdText = dataSvg.append("text")
				.text("Sample standard deviation: ")
				.attr("fill","black")
				.attr("x", 300)
				.attr("class", "dataText")
				.attr("y", 20);
			
			var cumulX = 1;
				
			var cumulText = dataSvg.append("text")
				.text("Sample cumulative distribution: ")
				.attr("fill","black")
				.attr("x", 20)
				.attr("class", "dataText")
				.attr("y", 50);
			
			var totalX = dataSvg.append("text")
				.text("Total samples: ")
				.attr("x", 300)
				.attr("class", "dataText")
				.attr("y", 50);
			
			d3.selectAll(".dataText")
				.attr("fill", axisColor)
				.attr("font-size", "12px")
			
			
			//______________________________________________________________________________________
			//Graph element variables
			//Axis
			//X
			
			//Initilaize rects
			var rects = createRects(data, decimals);
			
			var xAxis = d3.svg.axis().scale(scalex).orient("bottom").ticks(10);
			var xax = graphSvg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0, "+ (height)+")")
				.call(xAxis);

			xax.select("path")
				.attr("fill", "none")
				.attr("stroke", axisColor)
				.attr("shape-rendering", "crispEdges");

			xax.selectAll("text")
				.attr("fill",axisColor)
				.attr("font-size", "10px");

			//Y
			var yAxis = d3.svg.axis().scale(scaley).orient("left").ticks(10);
			var yax = graphSvg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate("+ widthOffsetLeft+", 0)")
				.call(yAxis);

			yax.select("path")
				.attr("fill", "none")
				.attr("stroke", axisColor)
				.attr("shape-rendering", "crispEdges");

			yax.selectAll("text")
				.attr("fill",axisColor)
				.attr("font-size", "10px");	

	/**		//Big tick line, shows mean
			var sampleEx = sampleMean(data, 0, 1);
			var tickline = graphSvg.append("svg:line")
				.attr("stroke", axisColor)
				.attr("stroke-width", 3)
				.attr("x1", scalex(sampleEx))
				.attr("x2", scalex(sampleEx))
				.attr("y1", height)
				.attr("y2", height);
			//Animation
			tickline
				.transition()
				.delay(1300)
				.attr("y1", height+6)
				.attr("y2", height-6);
			
			//Two small ticks, shows standard deviation	
			//Tick 1
			var sampleVar = sampleVariance(data, 0,1);
			var smalltick = graphSvg.append("svg:line")
				.attr("stroke", axisColor)
				.attr("stroke-width", 1)
				.attr("x1", scalex(sampleEx-Math.sqrt(sampleVar)))
				.attr("x2", scalex(sampleEx-Math.sqrt(sampleVar)))
				.attr("y1", height)
				.attr("y2", height);
			//Animation
			smalltick
				.transition()
				.delay(1700)
				.attr("y1", height+5)
				.attr("y2", height-5);	
				
			//Tick 2	
			var smalltick2 = graphSvg.append("svg:line")
				.attr("stroke", axisColor)
				.attr("stroke-width", 1)
				.attr("x1", scalex(sampleEx+Math.sqrt(sampleVar)))
				.attr("x2", scalex(sampleEx+Math.sqrt(sampleVar)))
				.attr("y1", height)
				.attr("y2", height);
			//Animation
			smalltick2
				.transition()
				.delay(1700)
				.attr("y1", height+5)
				.attr("y2", height-5);	
			**/
			

			
			sampleButton.onclick = function(){
				var placeHolderNumber = +d3.select(".input").property("value");
					if(getTotalData(rects.data()) + placeHolderNumber <= n){
						data = generateNewData(data, distribution, placeHolderNumber, decimals);
						updateRects(rects, data, decimals)
					}else if(getTotalData(rects.data()) < n){
						data = generateNewData(data, distribution, n-getTotalData(data), decimals);
						updateRects(rects, data, decimals)
					}else{
					
					}
					
					
				}
			
			resetButton.onclick = function(){
					var emptyData = []
					updateRects(rects, initData(data, decimals), decimals);
					maxY = updateYAxis(data, yAxis);
					deselectAllRects();
					
			}
			
			deselectStaplesButton.onclick = function(){
					deselectAllRects();
			}
			d3.select("#range").on("input", function(){
				inputText.value = input.value;
			})
			
			d3.select("#text").on("input", function(){
				input.value = inputText.value;
			})
			
			
			
		
			
		</script>
			
			
			</div>
		</div>
	</div>
</body>